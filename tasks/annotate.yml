---
###############################################################################
# Annotate User Configuration
###############################################################################
# Sanitize service configuration. Use data annotations to track config mapping
# and variable deprecation.
#
# Use r_pufky.data.v3 data annotations to enforce consistency and validation
# checks.
#
# Generates:
#   _pihole_map: list of dict - Annotated config map.
#   _pihole_order: list of str - Config section order.
#
# Reference:
# * https://docs.pi-hole.net/ftldns/configfile

- name: 'Annotate | sanitize & annotate service defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _pihole_srv_version: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_version,
        default='v6.3.2',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_srv_update_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_update_enable,
        default=true,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_srv_gravity_update_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_gravity_update_enable,
        default=true,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_srv_totp_display_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_totp_display_enable,
        default=true,
        hint='bool',
        added='6.1.4',
        order=4
        )
      }}"
    _srv_service_restart_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_service_restart_enable,
        default=false,
        hint='bool',
        added='6.3.2',
        order=5
        )
      }}"
    _pihole_srv_api: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_api | regex_replace('/$', ''),
        default='https://localhost:443/api',
        hint='str',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_srv_api_config_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_api_config_enable,
        default=false,
        hint='bool',
        added='6.1.4',
        order=7
        )
      }}"
    _pihole_srv_api_validate_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_api_validate_enable,
        default=false,
        hint='bool',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_srv_create_user: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_create_user,
        default=true,
        hint='bool',
        added='6.1.4',
        order=9
        )
      }}"
    _pihole_srv_user: "{{ {} | r_pufky.data.v3(
        raw=pihole_role_user.name,
        default='pihole',
        _uid='',
        hint='str',
        added='6.1.4',
        comment='Not user configurable.',
        order=10
        )
      }}"
    _pihole_srv_group: "{{ {} | r_pufky.data.v3(
        raw=pihole_role_group.name,
        default='pihole',
        _gid='',
        hint='str',
        added='6.1.4',
        comment='Not user configurable.',
        order=11
        )
      }}"
    _pihole_srv_backup_pre_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_backup_pre_enable,
        default=false,
        hint='bool',
        added='6.1.4',
        order=12
        )
      }}"
    _pihole_srv_backup_post_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_backup_post_enable,
        default=false,
        hint='bool',
        added='6.1.4',
        order=13
        )
      }}"
    _pihole_srv_backup_failures_enable: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_backup_failures_enable,
        default=true,
        hint='bool',
        added='6.1.4',
        order=14
        )
      }}"
    _pihole_srv_backup_dest: "{{ {} | r_pufky.data.v3(
        raw=pihole_srv_backup_dest | regex_replace('\\/$', '') ~ '/',
        default='group_vars/pihole/data/',
        hint='str',
        added='6.1.4',
        order=15
        )
      }}"

- name: 'Annotate | sanitize & annotate config defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _pihole_cfg_dns_upstreams: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='upstreams',
        raw=pihole_cfg_dns_upstreams,
        default=['8.8.8.8', '4.4.4.4'],
        hint='list of str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_cname_deep_inspect: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='CNAMEdeepInspect',
        raw=pihole_cfg_dns_cname_deep_inspect,
        default=true,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_block_esni: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='blockESNI',
        raw=pihole_cfg_dns_block_esni,
        default=true,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_edns0_ecs: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='EDNS0ECS',
        raw=pihole_cfg_dns_edns0_ecs,
        default=true,
        hint='bool',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_dns_ignore_localhost: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='ignoreLocalhost',
        raw=pihole_cfg_dns_ignore_localhost,
        default=false,
        hint='bool',
        added='6.1.4',
        order=5
        )
      }}"
    _pihole_cfg_dns_show_dnssec: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='showDNSSEC',
        raw=pihole_cfg_dns_show_dnssec,
        default=false,
        hint='bool',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_dns_analyze_only_a_and_aaaa: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='analyzeOnlyAandAAAA',
        raw=pihole_cfg_dns_analyze_only_a_and_aaaa,
        default=false,
        hint='bool',
        added='6.1.4',
        order=7
        )
      }}"
    _pihole_cfg_dns_pihole_ptr: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='piholePTR',
        raw=pihole_cfg_dns_pihole_ptr | upper,
        default='PI.HOLE',
        hint='str',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_cfg_dns_reply_when_busy: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='replyWhenBusy',
        raw=pihole_cfg_dns_reply_when_busy | upper,
        default='ALLOW',
        hint='str',
        added='6.1.4',
        order=9
        )
      }}"
    _pihole_cfg_dns_block_ttl: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='blockTTL',
        raw=pihole_cfg_dns_block_ttl,
        default=2,
        hint='int',
        added='6.1.4',
        order=10
        )
      }}"
    _pihole_cfg_dns_hosts: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='hosts',
        raw=pihole_cfg_dns_hosts,
        data=[],
        default=[],
        hint='list of dict',
        added='6.1.4',
        comment='<ip>,<host>.',
        order=11
        )
      }}"
    _pihole_cfg_dns_domain_needed: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='domainNeeded',
        raw=pihole_cfg_dns_domain_needed,
        default=false,
        hint='bool',
        added='6.1.4',
        order=12
        )
      }}"
    _pihole_cfg_dns_expand_hosts: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='expandHosts',
        raw=pihole_cfg_dns_expand_hosts,
        default=false,
        hint='bool',
        added='6.1.4',
        order=13
        )
      }}"
    _pihole_cfg_dns_domain: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='domain',
        raw=pihole_cfg_dns_domain,
        default='lan',
        hint='str',
        added='6.1.4',
        order=14
        )
      }}"
    _pihole_cfg_dns_bogus_priv: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='bogusPriv',
        raw=pihole_cfg_dns_bogus_priv,
        default=true,
        hint='bool',
        added='6.1.4',
        order=14
        )
      }}"
    _pihole_cfg_dns_dnssec: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='dnssec',
        raw=pihole_cfg_dns_dnssec,
        default=false,
        hint='bool',
        added='6.1.4',
        order=15
        )
      }}"
    _pihole_cfg_dns_interface: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='interface',
        raw=pihole_cfg_dns_interface,
        default='eth0',
        hint='str',
        added='6.1.4',
        order=16
        )
      }}"
    _pihole_cfg_dns_host_record: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='hostRecord',
        raw=pihole_cfg_dns_host_record,
        data=(
          ''
          if pihole_cfg_dns_host_record | length == 0 else
          [pihole_cfg_dns_host_record.name] | flatten | join(',') ~
          (
            ',' ~ pihole_cfg_dns_host_record.ipv4
            if pihole_cfg_dns_host_record.ipv4 | default('') | length > 0 else
            ''
          ) ~
          (
            ',' ~ pihole_cfg_dns_host_record.ipv6
            if pihole_cfg_dns_host_record.ipv6 | default('') | length > 0 else
            ''
          ) ~
          (
            ',' ~ pihole_cfg_dns_host_record.ttl
            if
              pihole_cfg_dns_host_record.ttl |
              default('') | string | length > 0
            else
            ''
          )
        ),
        default={},
        hint='dict',
        added='6.1.4',
        deprecated=true,
        comment=(
          '<name>[,<name>....],[<IPv4-address>],[<IPv6-address>][,<TTL>].'
        ),
        order=17
        )
      }}"
    _pihole_cfg_dns_listening_mode: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='listeningMode',
        raw=pihole_cfg_dns_listening_mode | upper,
        default='LOCAL',
        hint='str',
        added='6.1.4',
        order=18
        )
      }}"
    _pihole_cfg_dns_query_logging: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='queryLogging',
        raw=pihole_cfg_dns_query_logging,
        default=true,
        hint='bool',
        added='6.1.4',
        order=19
        )
      }}"
    _pihole_cfg_dns_cname_records: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='cnameRecords',
        raw=pihole_cfg_dns_cname_records,
        data=[],
        default=[],
        hint='list of dict',
        added='6.1.4',
        comment='<cname>,<target>[,<TTL>].',
        order=20
        )
      }}"
    _pihole_cfg_dns_port: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='port',
        raw=pihole_cfg_dns_port,
        default=53,
        hint='int',
        added='6.1.4',
        order=21
        )
      }}"
    _pihole_cfg_dns_rev_servers: "{{ {} | r_pufky.data.v3(
        section='dns',
        key='revServers',
        raw=pihole_cfg_dns_rev_servers,
        data=[],
        default=[],
        hint='list of dict',
        added='6.1.4',
        comment=(
          '<enabled>,<ip-address>[/<prefix-len>],<server>[#<port>][,<domain>]'
        ),
        order=22
        )
      }}"
    _pihole_cfg_dns_size: "{{ {} | r_pufky.data.v3(
        section='dns.cache',
        key='size',
        raw=pihole_cfg_dns_size,
        default=10000,
        hint='int',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_optimizer: "{{ {} | r_pufky.data.v3(
        section='dns.cache',
        key='optimizer',
        raw=pihole_cfg_dns_optimizer,
        default=3600,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_upstream_blocked_ttl: "{{ {} | r_pufky.data.v3(
        section='dns.cache',
        key='upstreamBlockedTTL',
        raw=pihole_cfg_dns_upstream_blocked_ttl,
        default=86400,
        hint='int',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_active: "{{ {} | r_pufky.data.v3(
        section='dns.blocking',
        key='active',
        raw=pihole_cfg_dns_active,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_mode: "{{ {} | r_pufky.data.v3(
        section='dns.blocking',
        key='mode',
        raw=pihole_cfg_dns_mode | upper,
        default='NULL',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_edns: "{{ {} | r_pufky.data.v3(
        section='dns.blocking',
        key='edns',
        raw=pihole_cfg_dns_edns | upper,
        default='TEXT',
        hint='str',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_mozilla_canary: "{{ {} | r_pufky.data.v3(
        section='dns.specialDomains',
        key='mozillaCanary',
        raw=pihole_cfg_dns_mozilla_canary,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_icloud_private_relay: "{{ {} | r_pufky.data.v3(
        section='dns.specialDomains',
        key='iCloudPrivateRelay',
        raw=pihole_cfg_dns_icloud_private_relay,
        default=true,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_designated_resolver: "{{ {} | r_pufky.data.v3(
        section='dns.specialDomains',
        key='designatedResolver',
        raw=pihole_cfg_dns_designated_resolver,
        default=true,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_host_force4: "{{ {} | r_pufky.data.v3(
        section='dns.reply.host',
        key='force4',
        raw=pihole_cfg_dns_host_force4,
        default=false,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_host_ipv4: "{{ {} | r_pufky.data.v3(
        section='dns.reply.host',
        key='IPv4',
        raw=pihole_cfg_dns_host_ipv4,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_host_force6: "{{ {} | r_pufky.data.v3(
        section='dns.reply.host',
        key='force6',
        raw=pihole_cfg_dns_host_force6,
        default=false,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_host_ipv6: "{{ {} | r_pufky.data.v3(
        section='dns.reply.host',
        key='IPv6',
        raw=pihole_cfg_dns_host_ipv6,
        default='',
        hint='str',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_dns_blocking_force4: "{{ {} | r_pufky.data.v3(
        section='dns.reply.blocking',
        key='force4',
        raw=pihole_cfg_dns_blocking_force4,
        default=false,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_blocking_ipv4: "{{ {} | r_pufky.data.v3(
        section='dns.reply.blocking',
        key='IPv4',
        raw=pihole_cfg_dns_blocking_ipv4,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dns_blocking_force6: "{{ {} | r_pufky.data.v3(
        section='dns.reply.blocking',
        key='force6',
        raw=pihole_cfg_dns_blocking_force6,
        default=false,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dns_blocking_ipv6: "{{ {} | r_pufky.data.v3(
        section='dns.reply.blocking',
        key='IPv6',
        raw=pihole_cfg_dns_blocking_ipv6,
        default='',
        hint='str',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_dns_count: "{{ {} | r_pufky.data.v3(
        section='dns.rateLimit',
        key='count',
        raw=pihole_cfg_dns_count,
        default=1000,
        hint='int',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dns_interval: "{{ {} | r_pufky.data.v3(
        section='dns.rateLimit',
        key='interval',
        raw=pihole_cfg_dns_interval,
        default=60,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_active: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='active',
        raw=pihole_cfg_dhcp_active,
        default=false,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dhcp_start: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='start',
        raw=pihole_cfg_dhcp_start,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_end: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='end',
        raw=pihole_cfg_dhcp_end,
        default='',
        hint='str',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dhcp_router: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='router',
        raw=pihole_cfg_dhcp_router,
        default='',
        hint='str',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_dhcp_netmask: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='netmask',
        raw=pihole_cfg_dhcp_netmask,
        default='',
        hint='str',
        added='6.1.4',
        order=5
        )
      }}"
    _pihole_cfg_dhcp_lease_time: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='leaseTime',
        raw=pihole_cfg_dhcp_lease_time,
        default='',
        hint='str',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_dhcp_ipv6: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='ipv6',
        raw=pihole_cfg_dhcp_ipv6,
        default=false,
        hint='bool',
        added='6.1.4',
        order=7
        )
      }}"
    _pihole_cfg_dhcp_rapid_commit: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='rapidCommit',
        raw=pihole_cfg_dhcp_rapid_commit,
        default=false,
        hint='bool',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_cfg_dhcp_multi_dns: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='multiDNS',
        raw=pihole_cfg_dhcp_multi_dns,
        default=false,
        hint='bool',
        added='6.1.4',
        order=9
        )
      }}"
    _pihole_cfg_dhcp_logging: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='logging',
        raw=pihole_cfg_dhcp_logging,
        default=false,
        hint='bool',
        added='6.1.4',
        order=10
        )
      }}"
    _pihole_cfg_dhcp_ignore_unknown_clients: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='ignoreUnknownClients',
        raw=pihole_cfg_dhcp_ignore_unknown_clients,
        default=false,
        hint='bool',
        added='6.1.4',
        order=11
        )
      }}"
    _pihole_cfg_dhcp_hosts: "{{ {} | r_pufky.data.v3(
        section='dhcp',
        key='hosts',
        raw=pihole_cfg_dhcp_hosts,
        data=[],
        default=[],
        hint='list of dict',
        added='6.1.4',
        comment=(
          '[<hwaddr>][,id:<client_id>|*][,set:<tag>][,tag:<tag>][,<ipaddr>]' ~
          '[,<hostname>][,<lease_time>][,ignore]'
        ),
        order=12
        )
      }}"
    _pihole_cfg_dhcp_ntp_ipv4_active: "{{ {} | r_pufky.data.v3(
        section='ntp.ipv4',
        key='active',
        raw=pihole_cfg_dhcp_ntp_ipv4_active,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dhcp_ntp_ipv4_address: "{{ {} | r_pufky.data.v3(
        section='ntp.ipv4',
        key='address',
        raw=pihole_cfg_dhcp_ntp_ipv4_address,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_ntp_ipv6_active: "{{ {} | r_pufky.data.v3(
        section='ntp.ipv6',
        key='active',
        raw=pihole_cfg_dhcp_ntp_ipv6_active,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dhcp_ntp_ipv6_address: "{{ {} | r_pufky.data.v3(
        section='ntp.ipv6',
        key='address',
        raw=pihole_cfg_dhcp_ntp_ipv6_address,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_active: "{{ {} | r_pufky.data.v3(
        section='ntp.sync',
        key='active',
        raw=pihole_cfg_dhcp_ntp_sync_active,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_server: "{{ {} | r_pufky.data.v3(
        section='ntp.sync',
        key='server',
        raw=pihole_cfg_dhcp_ntp_sync_server,
        default='pool.ntp.org',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_interval: "{{ {} | r_pufky.data.v3(
        section='ntp.sync',
        key='interval',
        raw=pihole_cfg_dhcp_ntp_sync_interval,
        default=3600,
        hint='int',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_count: "{{ {} | r_pufky.data.v3(
        section='ntp.sync',
        key='count',
        raw=pihole_cfg_dhcp_ntp_sync_count,
        default=8,
        hint='int',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_set: "{{ {} | r_pufky.data.v3(
        section='ntp.sync.rtc',
        key='set',
        raw=pihole_cfg_dhcp_ntp_sync_set,
        default=false,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_device: "{{ {} | r_pufky.data.v3(
        section='ntp.sync.rtc',
        key='device',
        raw=pihole_cfg_dhcp_ntp_sync_device,
        default='',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_dhcp_ntp_sync_utc: "{{ {} | r_pufky.data.v3(
        section='ntp.sync.rtc',
        key='utc',
        raw=pihole_cfg_dhcp_ntp_sync_utc,
        default=true,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_resolver_resolve_ipv4: "{{ {} | r_pufky.data.v3(
        section='resolver',
        key='resolveIPv4',
        raw=pihole_cfg_resolver_resolve_ipv4,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_resolver_resolve_ipv6: "{{ {} | r_pufky.data.v3(
        section='resolver',
        key='resolveIPv6',
        raw=pihole_cfg_resolver_resolve_ipv6,
        default=true,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_resolver_network_names: "{{ {} | r_pufky.data.v3(
        section='resolver',
        key='networkNames',
        raw=pihole_cfg_resolver_network_names,
        default=true,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_resolver_refresh_names: "{{ {} | r_pufky.data.v3(
        section='resolver',
        key='refreshNames',
        raw=pihole_cfg_resolver_refresh_names | upper,
        default='IPV4_ONLY',
        hint='str',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_database_db_import: "{{ {} | r_pufky.data.v3(
        section='database',
        key='DBimport',
        raw=pihole_cfg_database_db_import,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_database_max_db_days: "{{ {} | r_pufky.data.v3(
        section='database',
        key='maxDBdays',
        raw=pihole_cfg_database_max_db_days,
        default=91,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_database_db_interval: "{{ {} | r_pufky.data.v3(
        section='database',
        key='DBinterval',
        raw=pihole_cfg_database_db_interval,
        default=60,
        hint='int',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_database_use_wal: "{{ {} | r_pufky.data.v3(
        section='database',
        key='useWAL',
        raw=pihole_cfg_database_use_wal,
        default=true,
        hint='bool',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_database_network_parse_arp_cache: "{{ {} | r_pufky.data.v3(
        section='database.network',
        key='parseARPcache',
        raw=pihole_cfg_database_network_parse_arp_cache,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_database_network_expire: "{{ {} | r_pufky.data.v3(
        section='database.network',
        key='expire',
        raw=pihole_cfg_database_network_expire,
        default=91,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_webserver_domain: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='domain',
        raw=pihole_cfg_webserver_domain,
        default='pi.hole',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_acl: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='acl',
        raw=pihole_cfg_webserver_acl,
        data=pihole_cfg_webserver_acl | join(','),
        default=[],
        hint='list of str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_webserver_port: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='port',
        raw=pihole_cfg_webserver_port,
        data=pihole_cfg_webserver_port | join(','),
        default=[],
        hint='list of str',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_webserver_threads: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='threads',
        raw=pihole_cfg_webserver_threads,
        default=50,
        hint='int',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_webserver_headers: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='headers',
        raw=pihole_cfg_webserver_headers,
        data=[],
        default=pihole_role_unsafe_webserver_headers,
        hint='list of dict',
        added='6.1.4',
        comment='<header>=<value>',
        order=5
        )
      }}"
    _pihole_cfg_webserver_serve_all: "{{ {} | r_pufky.data.v3(
        section='webserver',
        key='serve_all',
        raw=pihole_cfg_webserver_serve_all,
        default=false,
        hint='bool',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_webserver_session_timeout: "{{ {} | r_pufky.data.v3(
        section='webserver.session',
        key='timeout',
        raw=pihole_cfg_webserver_session_timeout,
        default=1800,
        hint='int',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_session_restore: "{{ {} | r_pufky.data.v3(
        section='webserver.session',
        key='restore',
        raw=pihole_cfg_webserver_session_restore,
        default=true,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_webserver_tls_cert: "{{ {} | r_pufky.data.v3(
        section='webserver.tls',
        key='cert',
        raw=pihole_cfg_webserver_tls_cert,
        default='',
        _src=pihole_cfg_webserver_tls_cert,
        _dest='/etc/pihole/tls.pem',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_paths_webroot: "{{ {} | r_pufky.data.v3(
        section='webserver.paths',
        key='webroot',
        raw=pihole_cfg_webserver_paths_webroot,
        default='/var/www/html',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_paths_webhome: "{{ {} | r_pufky.data.v3(
        section='webserver.paths',
        key='webhome',
        raw=(
          pihole_cfg_webserver_paths_webhome |
          regex_replace('^(?!/)', '/') |
          regex_replace('([^/])$', '\\1/')
        ),
        default='/admin/',
        hint='str',
        added='6.1.4',
        comment='PiHole requires leading/trailing /.',
        order=2
        )
      }}"
    _pihole_cfg_webserver_paths_prefix: "{{ {} | r_pufky.data.v3(
        section='webserver.paths',
        key='prefix',
        raw=(
          pihole_cfg_webserver_paths_prefix | regex_replace('\\/?$', '/')
          if pihole_cfg_webserver_paths_prefix | length > 0 else
          ''
        ),
        default='',
        hint='str',
        added='6.1.4',
        comment='PiHole requires leading /.',
        order=3
        )
      }}"
    _pihole_cfg_webserver_interface_boxed: "{{ {} | r_pufky.data.v3(
        section='webserver.interface',
        key='boxed',
        raw=pihole_cfg_webserver_interface_boxed,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_interface_theme: "{{ {} | r_pufky.data.v3(
        section='webserver.interface',
        key='theme',
        raw=pihole_cfg_webserver_interface_theme,
        default='default-auto',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_webserver_api_max_sessions: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='max_sessions',
        raw=pihole_cfg_webserver_api_max_sessions,
        default=16,
        hint='int',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_api_pretty_json: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='prettyJSON',
        raw=pihole_cfg_webserver_api_pretty_json,
        default=false,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_webserver_api_pwhash: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='pwhash',
        raw=pihole_cfg_webserver_api_pwhash,
        data=pihole_cfg_webserver_api_pwhash,
        default='',
        hint='str',
        added='6.1.4',
        sensitive=true,
        order=3
        )
      }}"
    _pihole_cfg_webserver_api_totp_secret: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='totp_secret',
        raw=pihole_cfg_webserver_api_totp_secret,
        data='',
        default='',
        hint='str',
        added='6.1.4',
        sensitive=true,
        comment='Str TOTP hash calculated in prep.',
        order=4
        )
      }}"
    _pihole_cfg_webserver_api_app_pwhash: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='app_pwhash',
        raw=pihole_cfg_webserver_api_app_pwhash,
        data=pihole_cfg_webserver_api_app_pwhash,
        default='',
        hint='str',
        added='6.1.4',
        sensitive=true,
        order=5
        )
      }}"
    _pihole_cfg_webserver_api_app_sudo: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='app_sudo',
        raw=pihole_cfg_webserver_api_app_sudo,
        default=false,
        hint='bool',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_webserver_api_cli_pw: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='cli_pw',
        raw=pihole_cfg_webserver_api_cli_pw,
        default=true,
        hint='bool',
        added='6.1.4',
        sensitive=true,
        order=7
        )
      }}"
    _pihole_cfg_webserver_api_exclude_clients: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='excludeClients',
        raw=pihole_cfg_webserver_api_exclude_clients,
        data=pihole_cfg_webserver_api_exclude_clients | join(','),
        default=pihole_role_unsafe_empty,
        hint='list of str',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_cfg_webserver_api_exclude_domains: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='excludeDomains',
        raw=pihole_cfg_webserver_api_exclude_domains,
        data=pihole_cfg_webserver_api_exclude_domains | join(','),
        default=pihole_role_unsafe_empty,
        hint='list of str',
        added='6.1.4',
        order=9
        )
      }}"
    _pihole_cfg_webserver_api_max_history: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='maxHistory',
        raw=pihole_cfg_webserver_api_max_history,
        default=86400,
        hint='int',
        added='6.1.4',
        order=10
        )
      }}"
    _pihole_cfg_webserver_api_max_clients: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='maxClients',
        raw=pihole_cfg_webserver_api_max_clients,
        default=10,
        hint='int',
        added='6.1.4',
        order=11
        )
      }}"
    _pihole_cfg_webserver_api_client_history_global_max: "{{
      {} | r_pufky.data.v3(
        section='webserver.api',
        key='client_history_global_max',
        raw=pihole_cfg_webserver_api_client_history_global_max,
        default=true,
        hint='bool',
        added='6.1.4',
        order=12
        )
      }}"
    _pihole_cfg_webserver_api_allow_destructive: "{{ {} | r_pufky.data.v3(
        section='webserver.api',
        key='allow_destructive',
        raw=pihole_cfg_webserver_api_allow_destructive,
        default=true,
        hint='bool',
        added='6.1.4',
        order=13
        )
      }}"
    pihole_cfg_webserver_api_temp_limit: "{{ {} | r_pufky.data.v3(
        section='webserver.api.temp',
        key='limit',
        raw=pihole_cfg_webserver_api_temp_limit,
        default=60.000000,
        hint='float',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_webserver_api_temp_unit: "{{ {} | r_pufky.data.v3(
        section='webserver.api.temp',
        key='unit',
        raw=pihole_cfg_webserver_api_temp_unit | upper,
        default='C',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_files_pid: "{{ {} | r_pufky.data.v3(
        section='files',
        key='pid',
        raw=pihole_cfg_files_pid,
        default='/run/pihole-FTL.pid',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_files_database: "{{ {} | r_pufky.data.v3(
        section='files',
        key='database',
        raw=pihole_cfg_files_database,
        default='/etc/pihole/pihole-FTL.db',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_files_gravity: "{{ {} | r_pufky.data.v3(
        section='files',
        key='gravity',
        raw=pihole_cfg_files_gravity,
        default='/etc/pihole/pihole-FTL.db',
        hint='str',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_files_gravity_tmp: "{{ {} | r_pufky.data.v3(
        section='files',
        key='gravity_tmp',
        raw=pihole_cfg_files_gravity_tmp,
        default='/tmp',
        hint='str',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_files_macvendor: "{{ {} | r_pufky.data.v3(
        section='files',
        key='macvendor',
        raw=pihole_cfg_files_macvendor,
        default='/etc/pihole/macvendor.db',
        hint='str',
        added='6.1.4',
        order=5
        )
      }}"
    _pihole_cfg_files_pcap: "{{ {} | r_pufky.data.v3(
        section='files',
        key='pcap',
        raw=pihole_cfg_files_pcap,
        default='',
        hint='str',
        added='6.1.4',
        comment='Need to create file if defined.',
        order=5
        )
      }}"
    _pihole_cfg_files_log_ftl: "{{ {} | r_pufky.data.v3(
        section='files.log',
        key='ftl',
        raw=pihole_cfg_files_log_ftl,
        default='/var/log/pihole/FTL.log',
        hint='str',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_files_log_dnsmasq: "{{ {} | r_pufky.data.v3(
        section='files.log',
        key='dnsmasq',
        raw=pihole_cfg_files_log_dnsmasq,
        default='/var/log/pihole/pihole.log',
        hint='str',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_files_log_webserver: "{{ {} | r_pufky.data.v3(
        section='files.log',
        key='webserver',
        raw=pihole_cfg_files_log_webserver,
        default='/var/log/pihole/webserver.log',
        hint='str',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_misc_privacylevel: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='privacylevel',
        raw=pihole_cfg_misc_privacylevel,
        default=0,
        hint='int',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_misc_delay_startup: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='delay_startup',
        raw=pihole_cfg_misc_delay_startup,
        default=0,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_misc_nice: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='nice',
        raw=pihole_cfg_misc_nice,
        default=-10,
        hint='int',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_misc_addr2line: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='addr2line',
        raw=pihole_cfg_misc_addr2line,
        default=true,
        hint='bool',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_misc_etc_dnsmasq_d: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='etc_dnsmasq_d',
        raw=pihole_cfg_misc_etc_dnsmasq_d,
        default=false,
        hint='bool',
        added='6.1.4',
        order=5
        )
      }}"
    _pihole_cfg_misc_dnsmasq_lines: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='dnsmasq_lines',
        raw=pihole_cfg_misc_dnsmasq_lines,
        data=pihole_cfg_misc_dnsmasq_lines,
        default=[],
        hint='list of str',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_misc_extra_logging: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='extraLogging',
        raw=pihole_cfg_misc_extra_logging,
        default=false,
        hint='bool',
        added='6.1.4',
        order=7
        )
      }}"
    _pihole_cfg_misc_read_only: "{{ {} | r_pufky.data.v3(
        section='misc',
        key='readOnly',
        raw=pihole_cfg_misc_read_only,
        default=false,
        hint='bool',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_cfg_misc_check_load: "{{ {} | r_pufky.data.v3(
        section='misc.check',
        key='load',
        raw=pihole_cfg_misc_check_load,
        default=true,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_misc_check_shmem: "{{ {} | r_pufky.data.v3(
        section='misc.check',
        key='shmem',
        raw=pihole_cfg_misc_check_shmem,
        default=90,
        hint='int',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_misc_check_disk: "{{ {} | r_pufky.data.v3(
        section='misc.check',
        key='disk',
        raw=pihole_cfg_misc_check_disk,
        default=90,
        hint='int',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_debug_database: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='database',
        raw=pihole_cfg_debug_database,
        default=false,
        hint='bool',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_debug_networking: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='networking',
        raw=pihole_cfg_debug_networking,
        default=false,
        hint='bool',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_debug_locks: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='locks',
        raw=pihole_cfg_debug_locks,
        default=false,
        hint='bool',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_debug_queries: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='queries',
        raw=pihole_cfg_debug_queries,
        default=false,
        hint='bool',
        added='6.1.4',
        order=4
        )
      }}"
    _pihole_cfg_debug_flags: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='flags',
        raw=pihole_cfg_debug_flags,
        default=false,
        hint='bool',
        added='6.1.4',
        order=5
        )
      }}"
    _pihole_cfg_debug_shmem: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='shmem',
        raw=pihole_cfg_debug_shmem,
        default=false,
        hint='bool',
        added='6.1.4',
        order=6
        )
      }}"
    _pihole_cfg_debug_gc: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='gc',
        raw=pihole_cfg_debug_gc,
        default=false,
        hint='bool',
        added='6.1.4',
        order=7
        )
      }}"
    _pihole_cfg_debug_arp: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='arp',
        raw=pihole_cfg_debug_arp,
        default=false,
        hint='bool',
        added='6.1.4',
        order=8
        )
      }}"
    _pihole_cfg_debug_regex: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='regex',
        raw=pihole_cfg_debug_regex,
        default=false,
        hint='bool',
        added='6.1.4',
        order=9
        )
      }}"
    _pihole_cfg_debug_api: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='api',
        raw=pihole_cfg_debug_api,
        default=false,
        hint='bool',
        added='6.1.4',
        order=10
        )
      }}"
    _pihole_cfg_debug_tls: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='tls',
        raw=pihole_cfg_debug_tls,
        default=false,
        hint='bool',
        added='6.1.4',
        order=11
        )
      }}"
    _pihole_cfg_debug_overtime: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='overtime',
        raw=pihole_cfg_debug_overtime,
        default=false,
        hint='bool',
        added='6.1.4',
        order=12
        )
      }}"
    _pihole_cfg_debug_status: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='status',
        raw=pihole_cfg_debug_status,
        default=false,
        hint='bool',
        added='6.1.4',
        order=13
        )
      }}"
    _pihole_cfg_debug_caps: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='caps',
        raw=pihole_cfg_debug_caps,
        default=false,
        hint='bool',
        added='6.1.4',
        order=14
        )
      }}"
    _pihole_cfg_debug_dnssec: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='dnssec',
        raw=pihole_cfg_debug_dnssec,
        default=false,
        hint='bool',
        added='6.1.4',
        order=15
        )
      }}"
    _pihole_cfg_debug_vectors: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='vectors',
        raw=pihole_cfg_debug_vectors,
        default=false,
        hint='bool',
        added='6.1.4',
        order=16
        )
      }}"
    pihole_cfg_debug_resolver: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='resolver',
        raw=pihole_cfg_debug_resolver,
        default=false,
        hint='bool',
        added='6.1.4',
        order=17
        )
      }}"
    _pihole_cfg_debug_edns0: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='ends0',
        raw=pihole_cfg_debug_edns0,
        default=false,
        hint='bool',
        added='6.1.4',
        order=18
        )
      }}"
    _pihole_cfg_debug_clients: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='clients',
        raw=pihole_cfg_debug_clients,
        default=false,
        hint='bool',
        added='6.1.4',
        order=19
        )
      }}"
    _pihole_cfg_debug_aliasclients: "{{ {} | r_pufky.data.v3(
        section='debug',
        key='aliasclients',
        raw=pihole_cfg_debug_aliasclients,
        default=false,
        hint='bool',
        added='6.1.4',
        order=20
        )
      }}"
    _pihole_cfg_debug_events: "{{ {} | r_pufky.data.v3(
        section='events',
        key='aliasclients',
        raw=pihole_cfg_debug_events,
        default=false,
        hint='bool',
        added='6.1.4',
        order=21
        )
      }}"
    _pihole_cfg_debug_helper: "{{ {} | r_pufky.data.v3(
        section='events',
        key='helper',
        raw=pihole_cfg_debug_helper,
        default=false,
        hint='bool',
        added='6.1.4',
        order=22
        )
      }}"
    _pihole_cfg_debug_config: "{{ {} | r_pufky.data.v3(
        section='config',
        key='helper',
        raw=pihole_cfg_debug_config,
        default=false,
        hint='bool',
        added='6.1.4',
        order=23
        )
      }}"
    _pihole_cfg_debug_inotify: "{{ {} | r_pufky.data.v3(
        section='config',
        key='inotify',
        raw=pihole_cfg_debug_inotify,
        default=false,
        hint='bool',
        added='6.1.4',
        order=24
        )
      }}"
    _pihole_cfg_debug_webserver: "{{ {} | r_pufky.data.v3(
        section='config',
        key='webserver',
        raw=pihole_cfg_debug_webserver,
        default=false,
        hint='bool',
        added='6.1.4',
        order=25
        )
      }}"
    _pihole_cfg_debug_extra: "{{ {} | r_pufky.data.v3(
        section='config',
        key='extra',
        raw=pihole_cfg_debug_extra,
        default=false,
        hint='bool',
        added='6.1.4',
        order=26
        )
      }}"
    _pihole_cfg_debug_reserved: "{{ {} | r_pufky.data.v3(
        section='config',
        key='reserved',
        raw=pihole_cfg_debug_reserved,
        default=false,
        hint='bool',
        added='6.1.4',
        order=27
        )
      }}"
    _pihole_cfg_debug_ntp: "{{ {} | r_pufky.data.v3(
        section='config',
        key='ntp',
        raw=pihole_cfg_debug_ntp,
        default=false,
        hint='bool',
        added='6.1.4',
        order=28
        )
      }}"
    _pihole_cfg_debug_netlink: "{{ {} | r_pufky.data.v3(
        section='config',
        key='netlink',
        raw=pihole_cfg_debug_netlink,
        default=false,
        hint='bool',
        added='6.1.4',
        order=29
        )
      }}"
    _pihole_cfg_debug_all: "{{ {} | r_pufky.data.v3(
        section='config',
        key='all',
        raw=pihole_cfg_debug_all,
        default=false,
        hint='bool',
        added='6.1.4',
        order=30
        )
      }}"
    _pihole_cfg_mgmt_groups: "{{ {} | r_pufky.data.v3(
        section='api',
        raw=pihole_cfg_mgmt_groups,
        default=[
          {'name': 'Default', 'comment': 'The default group', 'enabled': true}
        ],
        _groups=pihole_cfg_mgmt_groups | map(attribute='name') | list,
        hint='list of dict',
        added='6.1.4',
        order=1
        )
      }}"
    _pihole_cfg_mgmt_clients: "{{ {} | r_pufky.data.v3(
        section='api',
        raw=pihole_cfg_mgmt_clients,
        default=[],
        _clients=pihole_cfg_mgmt_clients | map(attribute='client') | list,
        hint='list of dict',
        added='6.1.4',
        order=2
        )
      }}"
    _pihole_cfg_mgmt_domains: "{{ {} | r_pufky.data.v3(
        section='api',
        raw=pihole_cfg_mgmt_domains,
        default=[],
        _domains=pihole_cfg_mgmt_domains | map(attribute='domain') | list,
        hint='list of dict',
        added='6.1.4',
        order=3
        )
      }}"
    _pihole_cfg_mgmt_lists: "{{ {} | r_pufky.data.v3(
        section='api',
        raw=pihole_cfg_mgmt_lists,
        default=[],
        _lists=pihole_cfg_mgmt_lists | map(attribute='address') | list,
        hint='list of dict',
        added='6.1.4',
        order=4
        )
      }}"

- name: 'Annotate | normalize pihole_cfg_dns_hosts'
  ansible.builtin.set_fact:
    _pihole_cfg_dns_hosts: '{{
        _pihole_cfg_dns_hosts | combine({
          "data":
            _pihole_cfg_dns_hosts.data +
            [item.ip ~ " " ~ item.host]
        })
      }}'
  loop: '{{ _pihole_cfg_dns_hosts.raw }}'
  loop_control:
    label: '{{ item.host }}'

- name: 'Annotate | normalize pihole_cfg_dns_cname_records'
  ansible.builtin.set_fact:
    _pihole_cfg_dns_cname_records: '{{
        _pihole_cfg_dns_cname_records | combine({
          "data":
            _pihole_cfg_dns_cname_records.data +
            [
              item.cname ~ "," ~
              item.target ~
              (
                ""
                if item.ttl | default("") | string | length == 0 else
                "," ~ item.ttl
              )
            ]
        })
      }}'
  loop: '{{ _pihole_cfg_dns_cname_records.raw }}'
  loop_control:
    label: '{{ item.cname }}'

- name: 'Annotate | normalize pihole_cfg_dns_rev_servers'
  ansible.builtin.set_fact:
    _pihole_cfg_dns_rev_servers: '{{
        _pihole_cfg_dns_rev_servers | combine({
          "data":
            _pihole_cfg_dns_rev_servers.data +
            [
              item.enabled ~ "," ~
              item.ip ~ "," ~
              item.server ~
              (
                ""
                if item.domain | default("") | length == 0 else
                "," ~ item.domain
              )
            ]
        })
      }}'
  loop: '{{ _pihole_cfg_dns_rev_servers.raw }}'
  loop_control:
    label: '{{ item.server }}'

- name: 'Annotate | normalize pihole_cfg_dhcp_hosts'
  ansible.builtin.set_fact:
    _pihole_cfg_dhcp_hosts: '{{
        _pihole_cfg_dhcp_hosts | combine({
          "data":
            _pihole_cfg_dhcp_hosts.data +
            [
              (
                [item.hwaddr] | flatten | join(",")
                if item.hwaddr | default("") | length > 0 else
                ""
              ) ~
              (
                ",id:" ~ item.id
                if item.id | default("") | length > 0 else
                ""
              ) ~
              (
                ",set:" ~ [item.set] | flatten | join(",set:")
                if item.set | default("") | length > 0 else
                ""
              ) ~
              (
                ",tag:" ~ [item.tag] | flatten | join(",tag:")
                if item.tag | default("") | length > 0 else
                ""
              ) ~
              (
                "," ~ [item.ip] | flatten | join(",")
                if item.ip | default("") | length > 0 else
                ""
              ) ~
              (
                "," ~ item.hostname
                if item.hostname | default("") | length > 0 else
                ""
              ) ~
              (
                "," ~ item.lease
                if item.lease | default("") | length > 0 else
                ""
              ) ~
              (
                ",ignore"
                if item.ignore | default(false) else
                ""
              )
            ]
        })
      }}'
  loop: '{{ _pihole_cfg_dhcp_hosts.raw }}'
  loop_control:
    label: '{{ item.hostname | default(item.ip) }}'

- name: 'Annotate | normalize pihole_cfg_webserver_headers'
  ansible.builtin.set_fact:
    _pihole_cfg_webserver_headers: '{{
        _pihole_cfg_webserver_headers | combine({
          "data":
            _pihole_cfg_webserver_headers.data +
              [item.header ~ ": " ~ item.value]
        })
      }}'
  loop: '{{ _pihole_cfg_webserver_headers.raw }}'
  loop_control:
    label: '{{ item.header }}'

- name: 'Annotate | generate config map'
  ansible.builtin.set_fact:
    _pihole: {}
    _pihole_map: '{{
        hostvars[inventory_hostname] | dict2items |
        selectattr("key", "match", "_pihole_cfg_*")
      }}'
    _pihole_order:
      - 'dns'
      - 'dns.cache'
      - 'dns.blocking'
      - 'dns.specialDomains'
      - 'dns.reply.host'
      - 'dns.reply.blocking'
      - 'dns.rateLimit'
      - 'dhcp'
      - 'ntp.ipv4'
      - 'ntp.ipv6'
      - 'ntp.sync'
      - 'ntp.sync.rtc'
      - 'resolver'
      - 'database'
      - 'database.network'
      - 'webserver'
      - 'webserver.session'
      - 'webserver.tls'
      - 'webserver.paths'
      - 'webserver.interface'
      - 'webserver.api'
      - 'webserver.api.temp'
      - 'files'
      - 'files.log'
      - 'misc'
      - 'misc.check'
      - 'debug'
